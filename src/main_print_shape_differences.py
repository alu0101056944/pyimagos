'''
Universidad de La Laguna
Máster en Ingeniería Informática
Trabajo de Final de Máster
Pyimagos development

Print per contour-shape the shape score and the reason it returned infinite if
applies.
'''

import numpy as np

from src.expected_contours.distal_phalanx import (
  AllowedLineSideBasedOnYorXOnVertical
)
from src.expected_contours.distal_phalanx import ExpectedContourDistalPhalanx
from src.expected_contours.medial_phalanx import ExpectedContourMedialPhalanx
from src.expected_contours.proximal_phalanx import ExpectedContourProximalPhalanx
from src.expected_contours.metacarpal import ExpectedContourMetacarpal
from src.expected_contours.ulna import ExpectedContourUlna
from src.expected_contours.radius import ExpectedContourRadius

def get_string_scores(contours: list, contour_map: list,
                      expected_contours: list, title: str) -> list[str]:
  '''contour_map is the ordered version of contours which corresponds to the
  expected_contours sequence, which is a list of ExpectedContour classes.'''
  output_string = f'Printing shape score factor statuses for {title}\n'
  invalid_contours = False
  for i in range(len(contour_map)):
    contour = contours[contour_map[i]]
    expected_contour = expected_contours[i]
    
    points = np.reshape(contour, (-1, 2))
    if len(points) == 0:
      output_string = output_string + (
        f'Contour {i} is empty. Skipping.\n')
    
    all_x = points[:, 0]
    all_y = points[:, 1]
    min_x = np.min(all_x)
    max_x = np.max(all_x)
    min_y = np.min(all_y)
    max_y = np.max(all_y)
    image_width = int(max_x - min_x)
    image_height = int(max_y - min_y)
    expected_contour.prepare(contour, image_width, image_height)
    
    hu_moment, factorname_to_info = (
      expected_contour.shape_restrictions(decompose=True)
    )
    for factorname in factorname_to_info:
      info = factorname_to_info[factorname]
      fail_status = info['fail_status']
      actual_value = info['obtained_value']
      threshold_value = info['threshold_value']

      if fail_status == True:
        invalid_contours = True

      output_string = output_string + (
        f'Contour {i}, factor {factorname} ' \
        f'(type={type(expected_contour).__name__}): ' \
        f'{'Failed, ' if fail_status else 'Success, '}' \
        f'obtained={actual_value}, ' \
        f'threshold={threshold_value}\n')
  output_string = output_string + (
    f'Contours accepted: {"No." if invalid_contours else "Yes."} For {title}\n')
  return output_string

def case_004():
  contours = [
    np.array([ # ulna (0) 
      [[125, 417]],
      [[123, 419]],
      [[123, 421]],
      [[122, 422]],
      [[122, 426]],
      [[121, 427]],
      [[121, 428]],
      [[122, 429]],
      [[121, 430]],
      [[122, 431]],
      [[122, 432]],
      [[123, 433]],
      [[123, 443]],
      [[124, 444]],
      [[124, 467]],
      [[142, 467]],
      [[142, 466]],
      [[143, 465]],
      [[143, 461]],
      [[144, 460]],
      [[144, 457]],
      [[145, 456]],
      [[145, 455]],
      [[146, 454]],
      [[146, 452]],
      [[147, 451]],
      [[147, 449]],
      [[148, 448]],
      [[148, 447]],
      [[149, 446]],
      [[149, 445]],
      [[150, 444]],
      [[150, 442]],
      [[151, 441]],
      [[151, 433]],
      [[152, 432]],
      [[152, 431]],
      [[151, 430]],
      [[151, 427]],
      [[148, 424]],
      [[147, 424]],
      [[146, 423]],
      [[144, 423]],
      [[143, 422]],
      [[142, 423]],
      [[139, 423]],
      [[138, 424]],
      [[137, 424]],
      [[136, 425]],
      [[134, 425]],
      [[131, 422]],
      [[131, 421]],
      [[130, 421]],
      [[129, 420]],
      [[129, 419]],
      [[127, 417]]],
      dtype=np.int32
    ),
    np.array([ # radio (1) 
      [[203, 404]],
      [[202, 405]],
      [[199, 405]],
      [[197, 407]],
      [[196, 407]],
      [[194, 409]],
      [[193, 409]],
      [[192, 410]],
      [[191, 410]],
      [[190, 411]],
      [[188, 411]],
      [[190, 411]],
      [[191, 410]],
      [[193, 410]],
      [[194, 409]],
      [[195, 409]],
      [[197, 407]],
      [[198, 407]],
      [[200, 405]],
      [[202, 405]],
      [[203, 404]],
      [[208, 409]],
      [[208, 421]],
      [[207, 422]],
      [[207, 428]],
      [[206, 429]],
      [[206, 432]],
      [[205, 433]],
      [[204, 433]],
      [[204, 434]],
      [[203, 435]],
      [[204, 436]],
      [[204, 439]],
      [[203, 440]],
      [[203, 443]],
      [[202, 444]],
      [[202, 447]],
      [[201, 448]],
      [[201, 450]],
      [[200, 451]],
      [[200, 454]],
      [[199, 455]],
      [[199, 457]],
      [[198, 458]],
      [[198, 461]],
      [[197, 462]],
      [[197, 464]],
      [[196, 465]],
      [[196, 466]],
      [[195, 467]],
      [[163, 467]],
      [[162, 466]],
      [[162, 460]],
      [[161, 459]],
      [[161, 454]],
      [[160, 453]],
      [[160, 450]],
      [[159, 449]],
      [[159, 447]],
      [[158, 446]],
      [[158, 445]],
      [[157, 444]],
      [[157, 442]],
      [[156, 441]],
      [[156, 439]],
      [[154, 437]],
      [[154, 432]],
      [[155, 431]],
      [[155, 423]],
      [[156, 422]],
      [[156, 421]],
      [[158, 419]],
      [[159, 419]],
      [[160, 418]],
      [[161, 418]],
      [[162, 417]],
      [[165, 417]],
      [[166, 416]],
      [[169, 416]],
      [[170, 415]],
      [[177, 415]],
      [[178, 414]],
      [[184, 414]],
      [[185, 413]],
      [[187, 413]],
      [[185, 413]],
      [[184, 414]],
      [[178, 414]],
      [[177, 415]],
      [[170, 415]],
      [[169, 416]],
      [[166, 416]],
      [[165, 417]],
      [[162, 417]],
      [[161, 418]],
      [[160, 418]],
      [[159, 419]],
      [[158, 419]],
      [[156, 421]],
      [[156, 422]],
      [[155, 423]],
      [[155, 430]],
      [[154, 431]],
      [[154, 437]],
      [[155, 438]],
      [[155, 439]],
      [[156, 440]],
      [[156, 441]],
      [[157, 442]],
      [[157, 444]],
      [[158, 445]],
      [[158, 446]],
      [[159, 447]],
      [[159, 449]],
      [[160, 450]],
      [[160, 453]],
      [[161, 454]],
      [[161, 459]],
      [[162, 460]],
      [[162, 467]],
      [[196, 467]],
      [[196, 465]],
      [[197, 464]],
      [[197, 462]],
      [[198, 461]],
      [[198, 458]],
      [[199, 457]],
      [[199, 455]],
      [[200, 454]],
      [[200, 451]],
      [[201, 450]],
      [[201, 448]],
      [[202, 447]],
      [[202, 444]],
      [[203, 443]],
      [[203, 440]],
      [[204, 439]],
      [[204, 436]],
      [[203, 435]],
      [[206, 432]],
      [[206, 429]],
      [[207, 428]],
      [[207, 422]],
      [[208, 421]],
      [[208, 409]],
      [[207, 408]],
      [[207, 407]],
      [[204, 404]]],
      dtype=np.int32
    ),
    np.array([ # metacarpal 5 (2) 
      [[269, 308]],
      [[268, 309]],
      [[267, 309]],
      [[266, 310]],
      [[265, 310]],
      [[263, 312]],
      [[262, 312]],
      [[260, 314]],
      [[260, 317]],
      [[261, 318]],
      [[261, 321]],
      [[260, 322]],
      [[260, 324]],
      [[259, 325]],
      [[259, 326]],
      [[258, 327]],
      [[258, 328]],
      [[257, 329]],
      [[257, 330]],
      [[256, 331]],
      [[256, 332]],
      [[254, 334]],
      [[254, 335]],
      [[251, 338]],
      [[251, 339]],
      [[248, 342]],
      [[248, 343]],
      [[237, 354]],
      [[236, 354]],
      [[234, 356]],
      [[233, 356]],
      [[231, 358]],
      [[230, 358]],
      [[229, 359]],
      [[228, 359]],
      [[227, 360]],
      [[226, 360]],
      [[225, 361]],
      [[223, 361]],
      [[222, 362]],
      [[220, 362]],
      [[218, 364]],
      [[218, 369]],
      [[219, 370]],
      [[219, 372]],
      [[222, 375]],
      [[222, 376]],
      [[223, 377]],
      [[223, 378]],
      [[224, 379]],
      [[224, 380]],
      [[226, 382]],
      [[227, 382]],
      [[228, 383]],
      [[239, 383]],
      [[242, 380]],
      [[242, 379]],
      [[243, 378]],
      [[243, 377]],
      [[245, 375]],
      [[245, 374]],
      [[247, 372]],
      [[247, 371]],
      [[248, 370]],
      [[248, 369]],
      [[249, 368]],
      [[249, 367]],
      [[251, 365]],
      [[251, 364]],
      [[253, 362]],
      [[253, 361]],
      [[258, 356]],
      [[258, 355]],
      [[262, 351]],
      [[262, 350]],
      [[266, 346]],
      [[266, 345]],
      [[271, 340]],
      [[271, 339]],
      [[285, 325]],
      [[285, 323]],
      [[286, 322]],
      [[286, 319]],
      [[284, 317]],
      [[282, 317]],
      [[280, 315]],
      [[280, 314]],
      [[276, 310]],
      [[275, 310]],
      [[274, 309]],
      [[272, 309]],
      [[271, 308]]],
      dtype=np.int32
    ),
    np.array([ # proximal 5 (3) 
      [[306, 259]],
      [[304, 261]],
      [[303, 261]],
      [[303, 262]],
      [[302, 263]],
      [[302, 270]],
      [[301, 271]],
      [[301, 272]],
      [[300, 273]],
      [[300, 274]],
      [[299, 275]],
      [[299, 276]],
      [[296, 279]],
      [[296, 280]],
      [[292, 284]],
      [[291, 284]],
      [[287, 288]],
      [[286, 288]],
      [[284, 290]],
      [[283, 290]],
      [[281, 292]],
      [[280, 292]],
      [[276, 296]],
      [[275, 295]],
      [[272, 295]],
      [[270, 297]],
      [[270, 303]],
      [[271, 304]],
      [[272, 304]],
      [[273, 305]],
      [[274, 305]],
      [[279, 310]],
      [[280, 310]],
      [[282, 312]],
      [[283, 312]],
      [[286, 315]],
      [[287, 315]],
      [[290, 312]],
      [[290, 310]],
      [[292, 308]],
      [[292, 307]],
      [[293, 306]],
      [[293, 305]],
      [[294, 304]],
      [[294, 303]],
      [[295, 302]],
      [[295, 301]],
      [[297, 299]],
      [[297, 298]],
      [[299, 296]],
      [[299, 295]],
      [[301, 293]],
      [[301, 292]],
      [[304, 289]],
      [[304, 288]],
      [[314, 278]],
      [[314, 277]],
      [[315, 276]],
      [[316, 276]],
      [[319, 273]],
      [[319, 268]],
      [[318, 267]],
      [[318, 266]],
      [[316, 264]],
      [[313, 264]],
      [[312, 263]],
      [[312, 262]],
      [[311, 261]],
      [[310, 261]],
      [[308, 259]]],
      dtype=np.int32
    ),
    np.array([ # metacarpal 1 (4) 
      [[108, 257]],
      [[107, 258]],
      [[105, 258]],
      [[104, 259]],
      [[103, 259]],
      [[102, 260]],
      [[102, 261]],
      [[101, 262]],
      [[101, 270]],
      [[102, 271]],
      [[102, 274]],
      [[103, 275]],
      [[103, 276]],
      [[104, 277]],
      [[104, 278]],
      [[105, 279]],
      [[105, 280]],
      [[106, 281]],
      [[106, 283]],
      [[107, 284]],
      [[107, 285]],
      [[108, 286]],
      [[108, 287]],
      [[109, 288]],
      [[109, 289]],
      [[110, 290]],
      [[110, 292]],
      [[111, 293]],
      [[111, 294]],
      [[112, 295]],
      [[112, 297]],
      [[113, 298]],
      [[113, 299]],
      [[114, 300]],
      [[114, 302]],
      [[115, 303]],
      [[115, 305]],
      [[116, 306]],
      [[116, 308]],
      [[117, 309]],
      [[117, 311]],
      [[118, 312]],
      [[118, 314]],
      [[119, 315]],
      [[119, 318]],
      [[120, 319]],
      [[120, 322]],
      [[121, 323]],
      [[121, 330]],
      [[122, 331]],
      [[122, 337]],
      [[123, 338]],
      [[123, 342]],
      [[124, 343]],
      [[124, 345]],
      [[125, 346]],
      [[125, 348]],
      [[126, 349]],
      [[126, 350]],
      [[127, 351]],
      [[127, 353]],
      [[128, 354]],
      [[128, 355]],
      [[129, 356]],
      [[129, 357]],
      [[130, 358]],
      [[131, 358]],
      [[132, 359]],
      [[133, 358]],
      [[134, 358]],
      [[137, 355]],
      [[138, 355]],
      [[141, 352]],
      [[142, 352]],
      [[145, 349]],
      [[146, 349]],
      [[148, 347]],
      [[148, 346]],
      [[146, 344]],
      [[146, 343]],
      [[145, 342]],
      [[145, 341]],
      [[141, 337]],
      [[141, 336]],
      [[140, 335]],
      [[140, 334]],
      [[138, 332]],
      [[138, 331]],
      [[137, 330]],
      [[137, 329]],
      [[135, 327]],
      [[135, 325]],
      [[134, 324]],
      [[134, 322]],
      [[133, 321]],
      [[133, 320]],
      [[132, 319]],
      [[132, 318]],
      [[131, 317]],
      [[131, 315]],
      [[130, 314]],
      [[130, 313]],
      [[129, 312]],
      [[129, 309]],
      [[128, 308]],
      [[128, 306]],
      [[127, 305]],
      [[127, 303]],
      [[126, 302]],
      [[126, 300]],
      [[125, 299]],
      [[125, 297]],
      [[124, 296]],
      [[124, 294]],
      [[123, 293]],
      [[123, 291]],
      [[122, 290]],
      [[122, 287]],
      [[121, 286]],
      [[121, 283]],
      [[120, 282]],
      [[120, 278]],
      [[119, 277]],
      [[119, 274]],
      [[120, 273]],
      [[120, 272]],
      [[121, 271]],
      [[121, 265]],
      [[120, 264]],
      [[120, 262]],
      [[119, 261]],
      [[119, 260]],
      [[117, 258]],
      [[115, 258]],
      [[114, 257]]],
      dtype=np.int32
    ),
    np.array([ # metacarpal 2 (5) 
      [[138, 242]],
      [[137, 243]],
      [[135, 243]],
      [[133, 245]],
      [[132, 245]],
      [[131, 246]],
      [[131, 252]],
      [[132, 253]],
      [[132, 257]],
      [[133, 258]],
      [[133, 259]],
      [[134, 260]],
      [[134, 265]],
      [[135, 266]],
      [[135, 269]],
      [[136, 270]],
      [[136, 275]],
      [[137, 276]],
      [[137, 279]],
      [[138, 280]],
      [[138, 283]],
      [[139, 284]],
      [[139, 287]],
      [[140, 288]],
      [[140, 291]],
      [[141, 292]],
      [[141, 295]],
      [[142, 296]],
      [[142, 299]],
      [[143, 300]],
      [[143, 304]],
      [[144, 305]],
      [[144, 309]],
      [[145, 310]],
      [[145, 315]],
      [[146, 316]],
      [[146, 331]],
      [[145, 332]],
      [[145, 334]],
      [[144, 335]],
      [[144, 337]],
      [[145, 338]],
      [[147, 338]],
      [[148, 339]],
      [[153, 339]],
      [[154, 340]],
      [[160, 340]],
      [[161, 341]],
      [[164, 341]],
      [[164, 334]],
      [[163, 333]],
      [[163, 329]],
      [[162, 328]],
      [[162, 327]],
      [[161, 326]],
      [[161, 325]],
      [[160, 324]],
      [[160, 323]],
      [[159, 322]],
      [[159, 321]],
      [[158, 320]],
      [[158, 318]],
      [[157, 317]],
      [[157, 314]],
      [[156, 313]],
      [[156, 310]],
      [[155, 309]],
      [[155, 304]],
      [[154, 303]],
      [[154, 297]],
      [[153, 296]],
      [[153, 289]],
      [[152, 288]],
      [[152, 281]],
      [[151, 280]],
      [[151, 272]],
      [[150, 271]],
      [[150, 265]],
      [[151, 264]],
      [[151, 255]],
      [[152, 254]],
      [[152, 248]],
      [[148, 244]],
      [[147, 244]],
      [[146, 243]],
      [[143, 243]],
      [[142, 242]]],
      dtype=np.int32
    ),
    np.array([ # metacarpal 4 (6) 
      [[213, 232]],
      [[212, 233]],
      [[209, 233]],
      [[207, 235]],
      [[207, 237]],
      [[206, 238]],
      [[206, 239]],
      [[205, 240]],
      [[205, 242]],
      [[203, 244]],
      [[203, 246]],
      [[202, 247]],
      [[202, 248]],
      [[203, 249]],
      [[203, 262]],
      [[202, 263]],
      [[202, 274]],
      [[201, 275]],
      [[201, 288]],
      [[200, 289]],
      [[200, 304]],
      [[199, 305]],
      [[199, 317]],
      [[198, 318]],
      [[198, 323]],
      [[197, 324]],
      [[197, 328]],
      [[196, 329]],
      [[196, 331]],
      [[195, 332]],
      [[195, 334]],
      [[194, 335]],
      [[194, 337]],
      [[193, 338]],
      [[193, 339]],
      [[192, 340]],
      [[192, 341]],
      [[191, 342]],
      [[191, 344]],
      [[190, 345]],
      [[190, 347]],
      [[189, 348]],
      [[189, 350]],
      [[190, 350]],
      [[191, 351]],
      [[192, 351]],
      [[193, 352]],
      [[194, 352]],
      [[195, 353]],
      [[197, 353]],
      [[198, 354]],
      [[199, 354]],
      [[200, 355]],
      [[201, 355]],
      [[202, 356]],
      [[204, 356]],
      [[205, 357]],
      [[206, 357]],
      [[207, 358]],
      [[209, 358]],
      [[210, 359]],
      [[211, 359]],
      [[212, 360]],
      [[213, 360]],
      [[214, 361]],
      [[215, 361]],
      [[215, 360]],
      [[214, 359]],
      [[214, 358]],
      [[215, 357]],
      [[215, 353]],
      [[214, 352]],
      [[215, 351]],
      [[215, 348]],
      [[214, 347]],
      [[214, 343]],
      [[213, 342]],
      [[213, 339]],
      [[212, 338]],
      [[212, 314]],
      [[213, 313]],
      [[213, 306]],
      [[214, 305]],
      [[214, 298]],
      [[215, 297]],
      [[215, 293]],
      [[216, 292]],
      [[216, 288]],
      [[217, 287]],
      [[217, 284]],
      [[218, 283]],
      [[218, 280]],
      [[219, 279]],
      [[219, 277]],
      [[220, 276]],
      [[220, 273]],
      [[221, 272]],
      [[221, 270]],
      [[222, 269]],
      [[222, 265]],
      [[223, 264]],
      [[223, 262]],
      [[224, 261]],
      [[224, 260]],
      [[227, 257]],
      [[228, 257]],
      [[229, 256]],
      [[229, 254]],
      [[230, 253]],
      [[230, 248]],
      [[229, 247]],
      [[229, 244]],
      [[228, 243]],
      [[228, 241]],
      [[226, 241]],
      [[225, 240]],
      [[225, 239]],
      [[224, 238]],
      [[224, 236]],
      [[223, 235]],
      [[222, 235]],
      [[221, 234]],
      [[220, 234]],
      [[219, 233]],
      [[216, 233]],
      [[215, 232]]],
      dtype=np.int32
    ),
    np.array([ # metacarpal 3 (7) 
      [[173, 229]],
      [[172, 230]],
      [[168, 230]],
      [[167, 231]],
      [[166, 231]],
      [[164, 233]],
      [[164, 245]],
      [[163, 246]],
      [[163, 253]],
      [[164, 254]],
      [[164, 260]],
      [[165, 261]],
      [[165, 275]],
      [[166, 276]],
      [[166, 284]],
      [[167, 285]],
      [[167, 291]],
      [[168, 292]],
      [[168, 299]],
      [[169, 300]],
      [[169, 315]],
      [[170, 316]],
      [[170, 319]],
      [[169, 320]],
      [[169, 328]],
      [[168, 329]],
      [[168, 333]],
      [[170, 335]],
      [[171, 335]],
      [[174, 338]],
      [[175, 338]],
      [[179, 342]],
      [[180, 342]],
      [[183, 345]],
      [[184, 345]],
      [[186, 347]],
      [[186, 341]],
      [[187, 340]],
      [[187, 331]],
      [[186, 330]],
      [[186, 325]],
      [[185, 324]],
      [[185, 320]],
      [[184, 319]],
      [[184, 315]],
      [[183, 314]],
      [[183, 304]],
      [[182, 303]],
      [[182, 279]],
      [[183, 278]],
      [[183, 266]],
      [[184, 265]],
      [[184, 260]],
      [[185, 259]],
      [[185, 256]],
      [[186, 255]],
      [[186, 254]],
      [[187, 253]],
      [[187, 252]],
      [[189, 250]],
      [[190, 250]],
      [[190, 243]],
      [[189, 242]],
      [[189, 240]],
      [[188, 239]],
      [[188, 237]],
      [[183, 232]],
      [[182, 232]],
      [[181, 231]],
      [[179, 231]],
      [[178, 230]],
      [[174, 230]]],
      dtype=np.int32
    ),
    np.array([ # distal 5 (8)
      [[336, 220]],
      [[335, 221]],
      [[334, 221]],
      [[333, 222]],
      [[332, 222]],
      [[330, 224]],
      [[330, 225]],
      [[329, 226]],
      [[329, 227]],
      [[328, 228]],
      [[328, 229]],
      [[327, 230]],
      [[327, 231]],
      [[324, 234]],
      [[324, 235]],
      [[322, 237]],
      [[322, 238]],
      [[319, 241]],
      [[319, 242]],
      [[317, 244]],
      [[317, 245]],
      [[315, 247]],
      [[314, 247]],
      [[313, 248]],
      [[312, 248]],
      [[310, 250]],
      [[309, 250]],
      [[309, 251]],
      [[308, 252]],
      [[308, 255]],
      [[309, 256]],
      [[309, 257]],
      [[311, 259]],
      [[312, 259]],
      [[315, 262]],
      [[318, 262]],
      [[319, 263]],
      [[323, 263]],
      [[323, 258]],
      [[324, 257]],
      [[324, 253]],
      [[325, 252]],
      [[325, 250]],
      [[326, 249]],
      [[326, 247]],
      [[328, 245]],
      [[328, 244]],
      [[329, 243]],
      [[329, 241]],
      [[331, 239]],
      [[331, 238]],
      [[332, 237]],
      [[332, 236]],
      [[333, 235]],
      [[333, 234]],
      [[335, 232]],
      [[335, 231]],
      [[337, 229]],
      [[337, 228]],
      [[341, 224]],
      [[341, 221]],
      [[340, 220]]],
      dtype=np.int32
    ),
    np.array([ # proximal 1 (9)
      [[100, 191]],
      [[ 99, 192]],
      [[ 98, 192]],
      [[ 97, 193]],
      [[ 95, 193]],
      [[ 94, 194]],
      [[ 91, 194]],
      [[ 91, 195]],
      [[ 90, 196]],
      [[ 90, 199]],
      [[ 91, 200]],
      [[ 91, 202]],
      [[ 92, 203]],
      [[ 92, 205]],
      [[ 93, 206]],
      [[ 93, 207]],
      [[ 94, 208]],
      [[ 94, 210]],
      [[ 95, 211]],
      [[ 95, 216]],
      [[ 96, 217]],
      [[ 96, 223]],
      [[ 97, 224]],
      [[ 97, 233]],
      [[ 98, 234]],
      [[ 98, 241]],
      [[ 97, 242]],
      [[ 97, 247]],
      [[ 96, 248]],
      [[ 96, 251]],
      [[ 95, 252]],
      [[ 95, 254]],
      [[ 96, 255]],
      [[ 96, 256]],
      [[ 97, 257]],
      [[102, 257]],
      [[103, 256]],
      [[104, 256]],
      [[105, 255]],
      [[108, 255]],
      [[109, 254]],
      [[118, 254]],
      [[119, 253]],
      [[119, 248]],
      [[118, 247]],
      [[118, 246]],
      [[117, 245]],
      [[117, 244]],
      [[115, 242]],
      [[115, 241]],
      [[114, 240]],
      [[114, 239]],
      [[112, 237]],
      [[112, 236]],
      [[111, 235]],
      [[111, 233]],
      [[110, 232]],
      [[110, 230]],
      [[109, 229]],
      [[109, 227]],
      [[108, 226]],
      [[108, 223]],
      [[107, 222]],
      [[107, 219]],
      [[106, 218]],
      [[106, 214]],
      [[105, 213]],
      [[105, 207]],
      [[104, 206]],
      [[104, 203]],
      [[105, 202]],
      [[105, 197]],
      [[104, 196]],
      [[104, 193]],
      [[102, 191]]],
      dtype=np.int32
    ),
    np.array([ # proximal 2 (10)
      [[138, 158]],
      [[137, 159]],
      [[128, 159]],
      [[127, 160]],
      [[127, 171]],
      [[128, 172]],
      [[128, 173]],
      [[129, 174]],
      [[129, 177]],
      [[130, 178]],
      [[130, 198]],
      [[131, 199]],
      [[131, 211]],
      [[132, 212]],
      [[132, 218]],
      [[131, 219]],
      [[131, 225]],
      [[130, 226]],
      [[130, 229]],
      [[129, 230]],
      [[129, 232]],
      [[128, 233]],
      [[128, 235]],
      [[127, 236]],
      [[127, 237]],
      [[128, 238]],
      [[128, 239]],
      [[129, 240]],
      [[129, 241]],
      [[133, 241]],
      [[134, 240]],
      [[137, 240]],
      [[138, 239]],
      [[143, 239]],
      [[144, 240]],
      [[150, 240]],
      [[151, 239]],
      [[151, 238]],
      [[152, 237]],
      [[152, 232]],
      [[151, 231]],
      [[151, 230]],
      [[150, 229]],
      [[150, 227]],
      [[149, 226]],
      [[149, 224]],
      [[148, 223]],
      [[148, 222]],
      [[147, 221]],
      [[147, 218]],
      [[146, 217]],
      [[146, 213]],
      [[145, 212]],
      [[145, 203]],
      [[144, 202]],
      [[144, 190]],
      [[143, 189]],
      [[143, 170]],
      [[144, 169]],
      [[144, 168]],
      [[143, 167]],
      [[144, 166]],
      [[143, 165]],
      [[143, 160]],
      [[141, 158]]],
      dtype=np.int32
    ),
    np.array([ # medial 1 (11)
      [[ 93, 155]],
      [[ 92, 156]],
      [[ 89, 156]],
      [[ 88, 157]],
      [[ 82, 157]],
      [[ 82, 163]],
      [[ 83, 164]],
      [[ 83, 165]],
      [[ 85, 167]],
      [[ 85, 168]],
      [[ 86, 169]],
      [[ 86, 176]],
      [[ 87, 177]],
      [[ 87, 192]],
      [[ 93, 192]],
      [[ 94, 191]],
      [[ 96, 191]],
      [[ 97, 190]],
      [[ 98, 190]],
      [[ 99, 189]],
      [[102, 189]],
      [[103, 188]],
      [[103, 185]],
      [[101, 183]],
      [[101, 182]],
      [[ 99, 180]],
      [[ 99, 179]],
      [[ 97, 177]],
      [[ 97, 176]],
      [[ 96, 175]],
      [[ 96, 172]],
      [[ 95, 171]],
      [[ 95, 156]],
      [[ 94, 155]]],
      dtype=np.int32
    ),
    np.array([ # proximal 4 (12) 
      [[208, 149]],
      [[207, 150]],
      [[198, 150]],
      [[197, 151]],
      [[197, 162]],
      [[198, 163]],
      [[198, 165]],
      [[199, 166]],
      [[199, 171]],
      [[200, 172]],
      [[200, 184]],
      [[201, 185]],
      [[201, 192]],
      [[202, 193]],
      [[202, 205]],
      [[203, 206]],
      [[203, 213]],
      [[202, 214]],
      [[202, 220]],
      [[201, 221]],
      [[201, 224]],
      [[200, 225]],
      [[201, 226]],
      [[200, 227]],
      [[201, 228]],
      [[201, 231]],
      [[202, 231]],
      [[203, 232]],
      [[204, 232]],
      [[205, 231]],
      [[207, 231]],
      [[208, 230]],
      [[209, 230]],
      [[210, 229]],
      [[219, 229]],
      [[220, 230]],
      [[223, 230]],
      [[224, 229]],
      [[226, 229]],
      [[227, 228]],
      [[228, 228]],
      [[228, 226]],
      [[229, 225]],
      [[229, 223]],
      [[228, 222]],
      [[228, 220]],
      [[225, 217]],
      [[225, 216]],
      [[224, 215]],
      [[224, 214]],
      [[223, 213]],
      [[223, 211]],
      [[221, 209]],
      [[221, 207]],
      [[220, 206]],
      [[220, 204]],
      [[219, 203]],
      [[219, 200]],
      [[218, 199]],
      [[218, 195]],
      [[217, 194]],
      [[217, 190]],
      [[216, 189]],
      [[216, 184]],
      [[215, 183]],
      [[215, 181]],
      [[214, 180]],
      [[214, 164]],
      [[215, 163]],
      [[215, 153]],
      [[213, 151]],
      [[213, 150]],
      [[210, 150]],
      [[209, 149]]],
      dtype=np.int32
    ),
    np.array([ # proximal 3 (13)
      [[173, 137]],
      [[172, 138]],
      [[170, 138]],
      [[168, 140]],
      [[165, 140]],
      [[164, 139]],
      [[159, 139]],
      [[159, 146]],
      [[158, 147]],
      [[158, 148]],
      [[159, 149]],
      [[159, 153]],
      [[160, 154]],
      [[160, 159]],
      [[161, 160]],
      [[161, 182]],
      [[162, 183]],
      [[162, 198]],
      [[163, 199]],
      [[163, 205]],
      [[162, 206]],
      [[162, 214]],
      [[161, 215]],
      [[161, 217]],
      [[160, 218]],
      [[160, 220]],
      [[159, 221]],
      [[159, 222]],
      [[160, 223]],
      [[159, 224]],
      [[159, 225]],
      [[160, 226]],
      [[160, 227]],
      [[161, 228]],
      [[166, 228]],
      [[167, 227]],
      [[171, 227]],
      [[172, 226]],
      [[174, 226]],
      [[175, 227]],
      [[185, 227]],
      [[187, 225]],
      [[187, 218]],
      [[185, 216]],
      [[185, 214]],
      [[184, 213]],
      [[184, 212]],
      [[182, 210]],
      [[182, 208]],
      [[181, 207]],
      [[181, 205]],
      [[180, 204]],
      [[180, 202]],
      [[179, 201]],
      [[179, 197]],
      [[178, 196]],
      [[178, 189]],
      [[177, 188]],
      [[177, 179]],
      [[176, 178]],
      [[176, 168]],
      [[175, 167]],
      [[175, 153]],
      [[177, 151]],
      [[177, 145]],
      [[176, 144]],
      [[176, 141]],
      [[175, 140]],
      [[175, 139]]],
      dtype=np.int32
    ),
    np.array([ # distal 1 (14)
      [[ 84, 122]],
      [[ 83, 123]],
      [[ 82, 123]],
      [[ 81, 124]],
      [[ 81, 130]],
      [[ 82, 131]],
      [[ 82, 136]],
      [[ 83, 137]],
      [[ 83, 146]],
      [[ 82, 147]],
      [[ 82, 148]],
      [[ 81, 149]],
      [[ 81, 154]],
      [[ 82, 155]],
      [[ 87, 155]],
      [[ 88, 154]],
      [[ 91, 154]],
      [[ 92, 153]],
      [[ 93, 153]],
      [[ 94, 152]],
      [[ 94, 151]],
      [[ 95, 150]],
      [[ 94, 149]],
      [[ 94, 148]],
      [[ 91, 145]],
      [[ 91, 143]],
      [[ 89, 141]],
      [[ 89, 138]],
      [[ 88, 137]],
      [[ 88, 130]],
      [[ 89, 129]],
      [[ 89, 126]],
      [[ 88, 125]],
      [[ 88, 124]],
      [[ 86, 122]]],
      dtype=np.int32
    ),
    np.array([ # medial 2 (15)
      [[127, 107]],
      [[126, 108]],
      [[125, 108]],
      [[125, 110]],
      [[124, 111]],
      [[124, 115]],
      [[125, 116]],
      [[125, 118]],
      [[126, 119]],
      [[126, 123]],
      [[127, 124]],
      [[127, 130]],
      [[126, 131]],
      [[126, 140]],
      [[125, 141]],
      [[125, 151]],
      [[124, 152]],
      [[124, 156]],
      [[125, 157]],
      [[127, 157]],
      [[128, 156]],
      [[132, 156]],
      [[133, 157]],
      [[134, 156]],
      [[138, 156]],
      [[139, 155]],
      [[143, 155]],
      [[143, 150]],
      [[142, 149]],
      [[142, 146]],
      [[141, 145]],
      [[141, 141]],
      [[140, 140]],
      [[140, 136]],
      [[139, 135]],
      [[139, 131]],
      [[138, 130]],
      [[138, 119]],
      [[139, 118]],
      [[139, 117]],
      [[140, 116]],
      [[140, 111]],
      [[139, 110]],
      [[139, 108]],
      [[138, 107]],
      [[133, 107]],
      [[132, 108]],
      [[129, 108]],
      [[128, 107]]],
      dtype=np.int32
    ),
    np.array([ # medial 4 (16)
      [[202, 103]],
      [[201, 104]],
      [[199, 104]],
      [[198, 105]],
      [[194, 105]],
      [[194, 107]],
      [[193, 108]],
      [[193, 110]],
      [[194, 111]],
      [[194, 114]],
      [[195, 115]],
      [[195, 117]],
      [[196, 118]],
      [[196, 140]],
      [[195, 141]],
      [[195, 148]],
      [[196, 148]],
      [[197, 147]],
      [[201, 147]],
      [[202, 148]],
      [[205, 148]],
      [[206, 147]],
      [[208, 147]],
      [[209, 146]],
      [[211, 146]],
      [[212, 147]],
      [[213, 147]],
      [[215, 145]],
      [[215, 142]],
      [[214, 141]],
      [[214, 140]],
      [[213, 139]],
      [[213, 138]],
      [[212, 137]],
      [[212, 133]],
      [[211, 132]],
      [[211, 131]],
      [[210, 130]],
      [[210, 128]],
      [[208, 126]],
      [[208, 122]],
      [[207, 121]],
      [[207, 113]],
      [[208, 112]],
      [[208, 105]],
      [[207, 104]],
      [[207, 103]]],
      dtype=np.int32
    ),
    np.array([ # medial 3 (17)
      [[163,  82]],
      [[162,  83]],
      [[157,  83]],
      [[156,  84]],
      [[156,  87]],
      [[155,  88]],
      [[155,  92]],
      [[156,  93]],
      [[156,  96]],
      [[157,  97]],
      [[157, 102]],
      [[158, 103]],
      [[158, 106]],
      [[157, 107]],
      [[157, 125]],
      [[156, 126]],
      [[156, 131]],
      [[155, 132]],
      [[155, 134]],
      [[156, 135]],
      [[156, 136]],
      [[168, 136]],
      [[169, 135]],
      [[176, 135]],
      [[177, 134]],
      [[177, 132]],
      [[178, 131]],
      [[177, 130]],
      [[177, 129]],
      [[175, 127]],
      [[175, 122]],
      [[174, 121]],
      [[174, 119]],
      [[173, 118]],
      [[173, 116]],
      [[172, 115]],
      [[172, 112]],
      [[171, 111]],
      [[171, 109]],
      [[170, 108]],
      [[170, 104]],
      [[169, 103]],
      [[169,  96]],
      [[170,  95]],
      [[170,  93]],
      [[171,  92]],
      [[171,  91]],
      [[172,  90]],
      [[172,  87]],
      [[171,  86]],
      [[171,  85]],
      [[170,  84]],
      [[170,  83]],
      [[169,  82]]],
      dtype=np.int32
    ),
    np.array([ # distal 4 (18)
      [[190,  70]],
      [[190,  71]],
      [[188,  73]],
      [[188,  77]],
      [[189,  78]],
      [[189,  80]],
      [[190,  81]],
      [[190,  83]],
      [[191,  84]],
      [[191,  87]],
      [[192,  88]],
      [[192,  95]],
      [[191,  96]],
      [[191,  99]],
      [[192, 100]],
      [[192, 102]],
      [[193, 102]],
      [[194, 103]],
      [[195, 102]],
      [[199, 102]],
      [[200, 101]],
      [[201, 101]],
      [[202, 100]],
      [[205, 100]],
      [[206,  99]],
      [[206,  96]],
      [[205,  95]],
      [[205,  94]],
      [[204,  93]],
      [[204,  92]],
      [[201,  89]],
      [[201,  88]],
      [[200,  87]],
      [[200,  86]],
      [[199,  85]],
      [[199,  84]],
      [[198,  83]],
      [[198,  80]],
      [[197,  79]],
      [[197,  74]],
      [[196,  73]],
      [[196,  72]],
      [[194,  70]]],
      dtype=np.int32
    ),
    np.array([ # distal 2 (19)
      [[130,  70]],
      [[129,  71]],
      [[128,  71]],
      [[126,  73]],
      [[126,  74]],
      [[125,  75]],
      [[125,  78]],
      [[126,  79]],
      [[126,  82]],
      [[127,  83]],
      [[127,  86]],
      [[128,  87]],
      [[128,  90]],
      [[127,  91]],
      [[127,  94]],
      [[126,  95]],
      [[126,  97]],
      [[125,  98]],
      [[125,  99]],
      [[124, 100]],
      [[124, 102]],
      [[125, 103]],
      [[124, 104]],
      [[125, 105]],
      [[137, 105]],
      [[138, 104]],
      [[140, 104]],
      [[140, 100]],
      [[139,  99]],
      [[139,  98]],
      [[137,  96]],
      [[137,  94]],
      [[136,  93]],
      [[136,  90]],
      [[135,  89]],
      [[135,  81]],
      [[136,  80]],
      [[136,  75]],
      [[135,  74]],
      [[135,  72]],
      [[134,  71]],
      [[131,  71]]],
      dtype=np.int32
    ),
    np.array([ # distal 3 (20)
      [[156,  46]],
      [[153,  49]],
      [[153,  53]],
      [[155,  55]],
      [[155,  61]],
      [[156,  62]],
      [[156,  70]],
      [[155,  71]],
      [[155,  73]],
      [[154,  74]],
      [[154,  80]],
      [[155,  80]],
      [[156,  81]],
      [[158,  81]],
      [[159,  80]],
      [[164,  80]],
      [[165,  79]],
      [[168,  79]],
      [[169,  78]],
      [[170,  78]],
      [[170,  74]],
      [[168,  72]],
      [[168,  71]],
      [[167,  70]],
      [[167,  69]],
      [[166,  68]],
      [[166,  67]],
      [[165,  66]],
      [[165,  64]],
      [[164,  63]],
      [[164,  58]],
      [[163,  57]],
      [[164,  56]],
      [[164,  51]],
      [[163,  50]],
      [[163,  48]],
      [[162,  47]],
      [[161,  47]],
      [[160,  46]]],
      dtype=np.int32
    ),
  ]
  distal_1 = 14
  medial_1 = 11
  proximal_1 = 9
  metacarpal_1 = 4
  distal_2 = 19
  medial_2 = 15
  proximal_2 = 10
  metacarpal_2 = 5
  distal_3 = 20
  medial_3 = 17
  proximal_3 = 13
  metacarpal_3 = 7
  distal_4 = 18
  medial_4 = 16
  proximal_4 = 12
  metacarpal_4 = 6
  distal_5 = 8
  proximal_5 = 3
  metacarpal_5 = 2
  ulna = 0
  radio = 1

  contour_map = [
    distal_1, medial_1, proximal_1, metacarpal_1,
    distal_2, medial_2, proximal_2, metacarpal_2,
    distal_3, medial_3, proximal_3, metacarpal_3,
    distal_4, medial_4, proximal_4, metacarpal_4,
    distal_5, proximal_5, metacarpal_5,
    ulna,
    radio,
  ]

  expected_contours = get_canonical_expected_contours()

  return get_string_scores(
    contours,
    contour_map,
    expected_contours,
    '004 radiography'
  )

def get_canonical_expected_contours():
  '''Does not include sesamoid'''
  expected_contours = np.empty(21, dtype=object)
  expected_contours[0] = ExpectedContourDistalPhalanx(1)
  expected_contours[1] = ExpectedContourMedialPhalanx(1)
  expected_contours[2] = ExpectedContourProximalPhalanx(1)
  expected_contours[3] = ExpectedContourMetacarpal(
    1,
    ends_branchs_sequence=True,
    first_in_branch=expected_contours[0]
  )
  expected_contours[4] = ExpectedContourDistalPhalanx(
    2,
    first_encounter=expected_contours[0]
  )
  expected_contours[5] = ExpectedContourMedialPhalanx(
    2,
    first_encounter=expected_contours[1]
  )
  expected_contours[6] = ExpectedContourProximalPhalanx(
    2,
    first_encounter=expected_contours[2]
  )
  expected_contours[7] = ExpectedContourMetacarpal(
    2,
    ends_branchs_sequence=True,
    first_in_branch=expected_contours[4],
    first_encounter=expected_contours[3]
  )
  expected_contours[8] = ExpectedContourDistalPhalanx(
    3,
    first_encounter=expected_contours[0]
  )
  expected_contours[9] = ExpectedContourMedialPhalanx(
    3,
    first_encounter=expected_contours[1]
  )
  expected_contours[10] = ExpectedContourProximalPhalanx(
    3,
    first_encounter=expected_contours[2]
  )
  expected_contours[11] = ExpectedContourMetacarpal(
    3,
    ends_branchs_sequence=True,
    first_in_branch=expected_contours[8],
    first_encounter=expected_contours[3]
  )
  expected_contours[12] = ExpectedContourDistalPhalanx(
    4,
    first_encounter=expected_contours[0]
  )
  expected_contours[13] = ExpectedContourMedialPhalanx(
    4,
    first_encounter=expected_contours[1]
  )
  expected_contours[14] = ExpectedContourProximalPhalanx(
    4,
    first_encounter=expected_contours[2]
  )
  expected_contours[15] = ExpectedContourMetacarpal(
    4,
    ends_branchs_sequence=True,
    first_in_branch=expected_contours[12],
    first_encounter=expected_contours[3]
  )
  expected_contours[16] = ExpectedContourDistalPhalanx(
    5,
    first_encounter=expected_contours[0]
  )
  expected_contours[17] = ExpectedContourProximalPhalanx(
    5,
    first_encounter=expected_contours[2]
  )
  expected_contours[18] = ExpectedContourMetacarpal(
    5,
    first_encounter=expected_contours[3]
  )
  expected_contours[19] = ExpectedContourUlna()
  expected_contours[20] = ExpectedContourRadius()

  return expected_contours

def shape_differences_main():
  output_string = ''
  output_string = output_string + case_004()

  with open('shape_differences.txt', 'w') as f:
    f.write(output_string)
    print('Writing shape_differences.txt')
    print('Success.')
